---
import { navigation } from '../config/navigation';

const { links } = navigation;

// Pre-compute menu button SVG
const menuButtonSvg = `
  <svg
    class="block h-6 w-6"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 6h16M4 12h16M4 18h16"
    />
  </svg>
`;

// Pre-compute close button SVG
const closeButtonSvg = `
  <svg
    class="h-6 w-6"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M6 18L18 6M6 6l12 12"
    />
  </svg>
`;

// Determine current page for aria-current
const currentPath = Astro.url.pathname;

// Function to determine if a link is the current page
function isCurrentPage(href: string): boolean {
  // For full page routes (not hash links)
  if (!href.includes('#')) {
    // Exact match for root or about page
    return currentPath === href;
  }
  
  // For hash links, don't highlight them initially
  // They will be handled by the active-section.ts script
  return false;
}
---

<header class="fixed w-full top-0 z-50 bg-white/80 backdrop-blur-sm border-b border-neutral-dark/10 shadow-sm" role="banner">
  <nav class="container mx-auto px-6 py-4" aria-label="Main navigation">
    <div class="flex items-center justify-between">
      <a 
        href="/" 
        class="text-2xl font-heading font-bold text-primary hover:text-primary-dark transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 rounded-sm"
        aria-label="Comiendo Prejuicios - Home"
      >
        Comiendo Prejuicios
      </a>

      {/* Desktop Menu */}
      <div class="hidden md:flex items-center space-x-8" role="menubar">
        {links.map(link => {
          const current = isCurrentPage(link.href);
          return (
            <a
              href={link.href}
              data-nav-link
              class={`nav-link relative inline-block px-2 py-1 text-neutral-dark hover:text-primary transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 rounded-sm group ${current ? 'text-primary' : ''}`}
              role="menuitem"
              aria-current={current ? "page" : undefined}
            >
              {link.text}
              <span class={`absolute bottom-0 left-0 h-0.5 bg-primary transition-all duration-200 ${current ? 'w-full' : 'w-0 group-hover:w-full'}`}></span>
            </a>
          )
        })}
      </div>

      {/* Mobile Menu Button */}
      <button
        id="menu-button"
        type="button"
        aria-controls="mobile-menu"
        aria-expanded="false"
        aria-haspopup="true"
        aria-label="Open main menu"
        class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-neutral-dark hover:text-primary hover:bg-neutral-light/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2"
      >
        <span class="sr-only">Open main menu</span>
        <Fragment set:html={menuButtonSvg} />
      </button>
    </div>

    {/* Mobile Menu */}
    <div
      id="mobile-menu"
      class="fixed inset-y-0 right-0 w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out md:hidden"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
      aria-label="Mobile navigation menu"
    >
      <button
        id="close-menu"
        type="button"
        aria-label="Close menu"
        class="absolute top-4 right-4 rounded-md p-2 text-neutral-dark hover:text-primary hover:bg-neutral-light/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2"
      >
        <span class="sr-only">Close menu</span>
        <Fragment set:html={closeButtonSvg} />
      </button>

      <div class="pt-16 pb-4 px-4" role="menu">
        {links.map(link => {
          const current = isCurrentPage(link.href);
          return (
            <a
              href={link.href}
              data-nav-link
              class={`nav-link relative block w-full px-2 py-3 mb-2 text-neutral-dark hover:text-primary transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary rounded-sm ${current ? 'text-primary' : ''}`}
              role="menuitem"
              aria-current={current ? "page" : undefined}
            >
              {link.text}
            </a>
          )
        })}
      </div>
    </div>

    {/* Menu Overlay */}
    <div 
      id="menu-overlay" 
      class="fixed inset-0 bg-black/20 backdrop-blur-sm hidden md:hidden" 
      aria-hidden="true"
    ></div>
  </nav>
</header>

<script>
  import '../scripts/mobile-menu.ts';
  import '../scripts/active-section.ts';
</script>

<style>
  @media (max-width: 768px) {
    body.overflow-hidden {
      overflow: hidden;
    }
  }

  /* Active section styles */
  .nav-link {
    position: relative;
  }

  .nav-link.text-primary .nav-indicator {
    transform: scaleX(1);
  }

  /* Hover effect for non-active links */
  .nav-link:hover .nav-indicator {
    transform: scaleX(1);
  }

  /* Transition for the indicator */
  .nav-indicator {
    transform-origin: left;
    transition: transform 0.2s ease-in-out;
  }

  /* Ensure smooth transitions */
  .nav-link {
    transition: color 0.2s ease-in-out;
  }
</style>
