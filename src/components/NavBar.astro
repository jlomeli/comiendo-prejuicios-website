---
import { navigationConfig } from '../config/navigation';
import type { NavItem } from '../types/NavigationProps';

const navItems: NavItem[] = navigationConfig.items;

// Pre-compute menu button SVG
const menuButtonSvg = `
  <svg
    class="block h-6 w-6"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 6h16M4 12h16M4 18h16"
    />
  </svg>
`;

// Pre-compute close button SVG
const closeButtonSvg = `
  <svg
    class="h-6 w-6"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M6 18L18 6M6 6l12 12"
    />
  </svg>
`;

---

<nav 
  aria-label="Primary Navigation" 
  class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-40 print:hidden"
  style="contain: layout paint; content-visibility: auto;"
>
  <div class="container mx-auto px-4 sm:px-6">
    <div class="flex items-center justify-between h-16">
      <!-- Logo/Brand -->
      <div class="flex-shrink-0">
        <a 
          href="/" 
          class="text-xl font-heading font-semibold text-primary hover:text-primary_dark transition-colors duration-200"
          aria-label="Comiendo Prejuicios - Home"
        >
          Comiendo Prejuicios
        </a>
      </div>

      <!-- Skip to main content link -->
      <a 
        href="#main-content" 
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-white px-4 py-2 text-primary rounded shadow"
      >
        Skip to main content
      </a>

      <!-- Desktop Menu -->
      <ul 
        class="hidden md:flex md:items-center md:space-x-8" 
        role="menubar" 
        aria-label="Main navigation"
      >
        {navItems.map((item) => (
          <li role="none">
            <a 
              href={item.href}
              class="nav-link relative inline-block px-2 py-1 text-neutral_dark hover:text-primary transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary rounded group"
              aria-label={item.ariaLabel}
              role="menuitem"
              data-nav-link={item.href.startsWith('#')}
            >
              {item.label}
              <span class="absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 group-hover:scale-x-100 transition-transform duration-200 origin-left nav-indicator"></span>
            </a>
          </li>
        ))}
      </ul>

      <!-- Mobile Menu Button -->
      <button
        id="menu-button"
        type="button"
        class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-neutral_dark hover:text-primary hover:bg-neutral_light/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"
        aria-controls="mobile-menu"
        aria-expanded="false"
        aria-haspopup="true"
      >
        <span class="sr-only">Open main menu</span>
        <Fragment set:html={menuButtonSvg} />
      </button>
    </div>
  </div>

  <!-- Mobile menu, show/hide based on menu state -->
  <div
    id="menu-overlay"
    class="hidden fixed inset-0 bg-black bg-opacity-25 backdrop-blur-sm md:hidden z-40"
    aria-hidden="true"
  ></div>
  
  <div
    id="mobile-menu"
    class="fixed top-0 right-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out md:hidden z-50"
    role="dialog"
    aria-modal="true"
    aria-label="Main menu"
  >
    <div class="px-4 pt-8 pb-6">
      <!-- Close button -->
      <button
        id="menu-close-button"
        type="button"
        class="absolute top-4 right-4 rounded-md p-2 text-neutral_dark hover:text-primary hover:bg-neutral_light/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary"
        aria-label="Close menu"
      >
        <Fragment set:html={closeButtonSvg} />
      </button>

      <div class="mt-8">
        <ul 
          class="space-y-4" 
          role="menu" 
          aria-label="Mobile navigation"
        >
          {navItems.map((item) => (
            <li role="none">
              <a 
                href={item.href}
                class="nav-link relative block w-full px-2 py-1 text-neutral_dark hover:text-primary transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary rounded"
                aria-label={item.ariaLabel}
                role="menuitem"
                data-nav-link={item.href.startsWith('#')}
              >
                {item.label}
                <span class="absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 transition-transform duration-200 origin-left nav-indicator"></span>
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
  </div>
</nav>

<script>
  import '../scripts/mobile-menu.ts';
  import '../scripts/active-section.ts';
</script>

<style>
  @media (max-width: 768px) {
    body.overflow-hidden {
      overflow: hidden;
    }
  }

  /* Active section styles */
  .nav-link {
    position: relative;
  }

  .nav-link.text-primary .nav-indicator {
    transform: scaleX(1);
  }

  /* Hover effect for non-active links */
  .nav-link:hover .nav-indicator {
    transform: scaleX(1);
  }

  /* Transition for the indicator */
  .nav-indicator {
    transform-origin: left;
    transition: transform 0.2s ease-in-out;
  }

  /* Ensure smooth transitions */
  .nav-link {
    transition: color 0.2s ease-in-out;
  }
</style>
